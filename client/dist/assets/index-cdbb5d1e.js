(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const y of i.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&l(y)}).observe(document,{childList:!0,subtree:!0});function e(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function l(r){if(r.ep)return;r.ep=!0;const i=e(r);fetch(r.href,i)}})();class m{constructor(){this.onInit=()=>{},this.onState=()=>{},this.ws=new WebSocket(`ws://${location.hostname}:3000`),this.ws.onmessage=n=>{const e=JSON.parse(n.data);e.type==="init"&&this.onInit(e),e.type==="state"&&this.onState(e)}}send(n){this.ws.send(JSON.stringify(n))}}function g(t,n){const e=document.getElementById("ui");e&&(e.innerHTML=`
    <div>Vies : ${t}</div>
    <div>Cooldown : ${n>0?n.toFixed(1)+"s":"PrÃªt"}</div>
  `)}const d=document.getElementById("game"),o=d.getContext("2d");let f="",p=[],c={players:{},bullets:[],mines:[],map:[]};const a=new m;a.onInit=t=>{f=t.playerId,t.config,p=t.map};a.onState=t=>{c=t.state;const n=c.players[f];n&&g(n.lives,n.cooldown)};let w=0;d.addEventListener("mousemove",t=>{const n=d.getBoundingClientRect(),e=c.players[f];if(!e)return;const l=t.clientX-n.left-e.x,r=t.clientY-n.top-e.y;w=Math.atan2(r,l)});d.addEventListener("mousedown",()=>{a.send({type:"shoot",angle:w})});window.addEventListener("keydown",t=>{t.code==="Space"&&a.send({type:"mine"})});const s={};let u={dx:0,dy:0};window.addEventListener("keydown",t=>{["KeyZ","KeyQ","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(t.code)&&(s[t.code]=!0,t.preventDefault())});window.addEventListener("keyup",t=>{["KeyZ","KeyQ","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(t.code)&&(s[t.code]=!1,t.preventDefault())});function v(){let t=0,n=0;return(s.KeyZ||s.ArrowUp)&&(n-=1),(s.KeyS||s.ArrowDown)&&(n+=1),(s.KeyQ||s.ArrowLeft)&&(t-=1),(s.KeyD||s.ArrowRight)&&(t+=1),{dx:t,dy:n}}function h(){o.clearRect(0,0,d.width,d.height);const{dx:t,dy:n}=v();(t!==u.dx||n!==u.dy)&&(a.send({type:"move",dx:t,dy:n}),u={dx:t,dy:n});for(const e of p)o.save(),o.fillStyle="#888",e.type==="rect"?o.fillRect(e.x,e.y,e.width,e.height):(o.beginPath(),o.arc(e.x+e.width/2,e.y+e.height/2,e.width/2,0,2*Math.PI),o.fill()),o.restore();for(const e of c.mines)o.save(),o.fillStyle=e.exploded?"#f00":"#ff0",o.beginPath(),o.arc(e.x,e.y,12,0,2*Math.PI),o.fill(),o.restore();for(const e of c.bullets)o.save(),o.fillStyle="#fff",o.beginPath(),o.arc(e.x,e.y,6,0,2*Math.PI),o.fill(),o.restore();for(const e in c.players){const l=c.players[e];o.save(),o.translate(l.x,l.y),o.rotate(l.angle),o.fillStyle=e===f?"#0f0":"#0ff",o.fillRect(-20,-15,40,30),o.fillStyle="#444",o.fillRect(0,-5,30,10),o.restore()}requestAnimationFrame(h)}h();
