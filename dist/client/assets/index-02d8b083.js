(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&l(h)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function l(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();class M{constructor(){this.onInit=()=>{},this.onState=()=>{},this.messageQueue=[],this.isConnected=!1;const i=location.port||"8080";this.ws=new WebSocket(`ws://${location.hostname}:${i}`),this.ws.onopen=()=>{for(console.log("Connected to game server"),this.isConnected=!0;this.messageQueue.length>0;){const s=this.messageQueue.shift();this.ws.send(JSON.stringify(s))}},this.ws.onmessage=s=>{const l=JSON.parse(s.data);l.type==="init"&&this.onInit(l),l.type==="state"&&this.onState(l)},this.ws.onerror=s=>{console.error("WebSocket error:",s)},this.ws.onclose=()=>{console.log("Disconnected from game server"),this.isConnected=!1}}send(i){this.isConnected&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(i)):(this.messageQueue.push(i),console.log("Message queued, WebSocket not ready yet"))}}function I(o,i,s,l){const r=document.getElementById("ui");if(!r)return;const a=i>0?`Cooldown ${(i/1e3).toFixed(1)}s`:"Ready",h=i>0?"#ff6b6b":"#51cf66";r.innerHTML=`
    <div style="background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 2px solid #4CAF50;">
      <div style="font-size: 20px; font-weight: bold; color: #ff6b6b;">‚ù§Ô∏è Lives: ${o}</div>
      <div style="font-size: 16px; color: ${h};">‚è±Ô∏è Status: ${a}</div>
      ${s?`<div style="font-size: 14px; color: #74c0fc;">üë• Players: ${s}</div>`:""}
      ${l!==void 0?`<div style="font-size: 14px; color: #ffd43b;">üí£ Mines: ${l}</div>`:""}
    </div>
    <div style="background: rgba(0,0,0,0.7); padding: 12px; border-radius: 8px; font-size: 13px; line-height: 1.4;">
      <div style="font-weight: bold; margin-bottom: 5px;">üéÆ <strong>Tank Controls:</strong></div>
      <div>‚Ä¢ <strong>‚Üë:</strong> Move forward</div>
      <div>‚Ä¢ <strong>‚Üì:</strong> Move backward</div>
      <div>‚Ä¢ <strong>‚Üê:</strong> Turn tank left</div>
      <div>‚Ä¢ <strong>‚Üí:</strong> Turn tank right</div>
      <div>‚Ä¢ <strong>A:</strong> Turn cannon left</div>
      <div>‚Ä¢ <strong>D:</strong> Turn cannon right</div>
      <div>‚Ä¢ <strong>Left Click:</strong> Shoot</div>
      <div>‚Ä¢ <strong>Spacebar:</strong> Place mine</div>
    </div>
  `}const c=document.getElementById("game"),e=c.getContext("2d");let u="",w,x=[],d={x:0,y:0};function S(){c.width=window.innerWidth,c.height=window.innerHeight}S();window.addEventListener("resize",S);let y={players:{},bullets:[],mines:[],map:[]},k=[];const v=new M;v.onInit=o=>{u=o.playerId,w=o.config,x=o.map,console.log("Player initialized:",u)};v.onState=o=>{y=o.state;const i=y.players[u];if(i){const s=Object.keys(y.players).length,l=i.mines.length;I(i.lives,i.cooldown,s,l),d.x=i.x-c.width/2,d.y=i.y-c.height/2,w&&(d.x=Math.max(0,Math.min(w.mapWidth-c.width,d.x)),d.y=Math.max(0,Math.min(w.mapHeight-c.height,d.y)))}};c.addEventListener("mousedown",()=>{if(!u){console.log("Player not initialized yet");return}v.send({type:"shoot"});const o=y.players[u];o&&k.push({x:o.x+Math.cos(o.cannonAngle)*o.cannonLength,y:o.y+Math.sin(o.cannonAngle)*o.cannonLength,time:Date.now()})});window.addEventListener("keydown",o=>{if(o.code==="Space"){if(!u){console.log("Player not initialized yet");return}v.send({type:"mine"})}});const g={};let p={forward:0,turn:0,cannonTurn:0};window.addEventListener("keydown",o=>{["KeyA","KeyD","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(o.code)&&(g[o.code]=!0,o.preventDefault())});window.addEventListener("keyup",o=>{["KeyA","KeyD","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(o.code)&&(g[o.code]=!1,o.preventDefault())});function R(){let o=0,i=0,s=0;return g.ArrowUp&&(o+=1),g.ArrowDown&&(o-=1),g.ArrowLeft&&(i-=1),g.ArrowRight&&(i+=1),g.KeyA&&(s-=1),g.KeyD&&(s+=1),{forward:o,turn:i,cannonTurn:s}}function P(){e.clearRect(0,0,c.width,c.height),e.save(),e.translate(-d.x,-d.y),e.save(),e.strokeStyle="#444",e.lineWidth=1;const o=50,i=Math.floor(d.x/o)*o,s=i+c.width+o,l=Math.floor(d.y/o)*o,r=l+c.height+o;for(let t=i;t<=s;t+=o)e.beginPath(),e.moveTo(t,d.y),e.lineTo(t,d.y+c.height),e.stroke();for(let t=l;t<=r;t+=o)e.beginPath(),e.moveTo(d.x,t),e.lineTo(d.x+c.width,t),e.stroke();e.restore();const{forward:a,turn:h,cannonTurn:b}=R();(a!==p.forward||h!==p.turn||b!==p.cannonTurn)&&u&&(v.send({type:"move",forward:a,turn:h,cannonTurn:b}),p={forward:a,turn:h,cannonTurn:b});for(const t of x)e.save(),e.fillStyle="#666",e.strokeStyle="#333",e.lineWidth=2,t.type==="rect"?(e.fillRect(t.x,t.y,t.width,t.height),e.strokeRect(t.x,t.y,t.width,t.height)):(e.beginPath(),e.arc(t.x+t.width/2,t.y+t.height/2,t.width/2,0,2*Math.PI),e.fill(),e.stroke()),e.restore();for(const t of y.mines){e.save();const n=Math.floor(Date.now()/200)%2;e.fillStyle=t.exploded||n?"#ff0000":"#ffff00",e.strokeStyle="#cc0000",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,8,0,2*Math.PI),e.fill(),e.stroke(),t.exploded||(e.fillStyle="#fff",e.font="10px Arial",e.textAlign="center",e.fillText("!",t.x,t.y+3)),e.restore()}for(const t of y.bullets)e.save(),e.fillStyle="#ffff00",e.strokeStyle="#ffaa00",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,4,0,2*Math.PI),e.fill(),e.stroke(),e.restore();for(const t in y.players){const n=y.players[t];if(n.lives<=0||Date.now()<n.deadUntil)continue;e.save(),e.translate(n.x,n.y),e.rotate(n.angle),A(e,n);const f=t===u;e.fillStyle="#4a4a4a",e.fillRect(-n.bodyWidth/2,-n.bodyHeight/2,n.bodyWidth,n.bodyHeight),e.strokeStyle="#2a2a2a",e.lineWidth=2,e.strokeRect(-n.bodyWidth/2,-n.bodyHeight/2,n.bodyWidth,n.bodyHeight),e.fillStyle=f?"#5a5a5a":"#4a4a5a",e.beginPath(),e.arc(0,0,n.turretRadius,0,Math.PI*2),e.fill(),e.stroke(),e.save(),e.rotate(n.cannonAngle-n.angle),e.fillStyle="#3a3a3a",e.fillRect(0,-n.cannonWidth/2,n.cannonLength,n.cannonWidth),e.strokeRect(0,-n.cannonWidth/2,n.cannonLength,n.cannonWidth),e.fillStyle="#2a2a2a",e.beginPath(),e.arc(n.cannonLength,0,n.cannonWidth/2,0,Math.PI*2),e.fill(),e.restore(),e.fillStyle=f?"#6a6a6a":"#5a5a6a",e.beginPath(),e.arc(0,0,8,0,Math.PI*2),e.fill(),e.restore(),e.save(),e.translate(n.x,n.y),e.fillStyle="rgba(0,0,0,0.7)",e.fillRect(-35,-50,70,15),e.fillStyle=f?"#4CAF50":"#2196F3",e.font="bold 12px Arial",e.textAlign="center",e.fillText(f?"YOU":`P${t.slice(0,3)}`,0,-40);const m=50,W=n.lives/((w==null?void 0:w.maxLives)||3)*m;e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(-25,35,m,4),e.fillStyle=n.lives>1?"#4CAF50":"#F44336",e.fillRect(-25,35,W,4),e.restore()}function A(t,n){t.fillStyle="#2a2a2a",t.fillRect(-n.trackLength/2,-n.bodyHeight/2-n.trackWidth,n.trackLength,n.trackWidth),t.fillRect(-n.trackLength/2,n.bodyHeight/2,n.trackLength,n.trackWidth),t.fillStyle="#1a1a1a";for(let f=-n.trackLength/2+10;f<n.trackLength/2;f+=15)t.beginPath(),t.arc(f,-n.bodyHeight/2-n.trackWidth/2,4,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(f,n.bodyHeight/2+n.trackWidth/2,4,0,Math.PI*2),t.fill()}const L=Date.now();k=k.filter(t=>{const n=L-t.time;if(n>200)return!1;e.save();const f=1-n/200;e.globalAlpha=f,e.fillStyle="#ffaa00";const m=5+n/200*10;return e.beginPath(),e.arc(t.x,t.y,m,0,2*Math.PI),e.fill(),e.restore(),!0}),e.restore(),requestAnimationFrame(P)}P();
