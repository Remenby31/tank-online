(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))l(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&l(f)}).observe(document,{childList:!0,subtree:!0});function a(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(r){if(r.ep)return;r.ep=!0;const s=a(r);fetch(r.href,s)}})();class R{constructor(){this.onInit=()=>{},this.onState=()=>{},this.messageQueue=[],this.isConnected=!1;const i=location.port||"8080";this.ws=new WebSocket(`ws://${location.hostname}:${i}`),this.ws.onopen=()=>{for(console.log("Connected to game server"),this.isConnected=!0;this.messageQueue.length>0;){const a=this.messageQueue.shift();this.ws.send(JSON.stringify(a))}},this.ws.onmessage=a=>{const l=JSON.parse(a.data);l.type==="init"&&this.onInit(l),l.type==="state"&&this.onState(l)},this.ws.onerror=a=>{console.error("WebSocket error:",a)},this.ws.onclose=()=>{console.log("Disconnected from game server"),this.isConnected=!1}}send(i){this.isConnected&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(i)):(this.messageQueue.push(i),console.log("Message queued, WebSocket not ready yet"))}}function I(o,i,a,l){const r=document.getElementById("ui");if(!r)return;const s=i>0?`Cooldown ${(i/1e3).toFixed(1)}s`:"Ready",f=i>0?"#ff6b6b":"#51cf66";r.innerHTML=`
    <div style="background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 2px solid #4CAF50;">
      <div style="font-size: 20px; font-weight: bold; color: #ff6b6b;">‚ù§Ô∏è Lives: ${o}</div>
      <div style="font-size: 16px; color: ${f};">‚è±Ô∏è Status: ${s}</div>
      ${a?`<div style="font-size: 14px; color: #74c0fc;">üë• Players: ${a}</div>`:""}
      ${l!==void 0?`<div style="font-size: 14px; color: #ffd43b;">üí£ Mines: ${l}</div>`:""}
    </div>
    <div style="background: rgba(0,0,0,0.7); padding: 12px; border-radius: 8px; font-size: 13px; line-height: 1.4;">
      <div style="font-weight: bold; margin-bottom: 5px;">üéÆ <strong>Tank Controls:</strong></div>
      <div>‚Ä¢ <strong>‚Üë:</strong> Move forward</div>
      <div>‚Ä¢ <strong>‚Üì:</strong> Move backward</div>
      <div>‚Ä¢ <strong>‚Üê:</strong> Turn tank left</div>
      <div>‚Ä¢ <strong>‚Üí:</strong> Turn tank right</div>
      <div>‚Ä¢ <strong>Mouse:</strong> Aim cannon</div>
      <div>‚Ä¢ <strong>Left Click:</strong> Shoot</div>
      <div>‚Ä¢ <strong>Spacebar:</strong> Place mine</div>
    </div>
  `}const c=document.getElementById("game"),e=c.getContext("2d");let g="",u,S=[],d={x:0,y:0};function P(){c.width=window.innerWidth,c.height=window.innerHeight}P();window.addEventListener("resize",P);let y={players:{},bullets:[],mines:[],map:[]},x=[];const w=new R;w.onInit=o=>{g=o.playerId,u=o.config,S=o.map,console.log("Player initialized:",g)};w.onState=o=>{y=o.state;const i=y.players[g];if(i){const a=Object.keys(y.players).length,l=i.mines.length;I(i.lives,i.cooldown,a,l),d.x=i.x-c.width/2,d.y=i.y-c.height/2,u&&(d.x=Math.max(0,Math.min(u.mapWidth-c.width,d.x)),d.y=Math.max(0,Math.min(u.mapHeight-c.height,d.y)))}};c.addEventListener("mousemove",o=>{const i=c.getBoundingClientRect(),a=y.players[g];if(!a)return;const l=o.clientX-i.left+d.x,r=o.clientY-i.top+d.y,s=l-a.x,f=r-a.y;v=Math.atan2(f,s),g&&Math.abs(v-k)>.1&&(w.send({type:"cannonAim",angle:v}),k=v)});c.addEventListener("mousedown",()=>{if(!g){console.log("Player not initialized yet");return}w.send({type:"shoot"});const o=y.players[g];o&&x.push({x:o.x+Math.cos(o.cannonAngle)*o.cannonLength,y:o.y+Math.sin(o.cannonAngle)*o.cannonLength,time:Date.now()})});window.addEventListener("keydown",o=>{if(o.code==="Space"){if(!g){console.log("Player not initialized yet");return}w.send({type:"mine"})}});const m={};let b={forward:0,turn:0},v=0,k=0;window.addEventListener("keydown",o=>{["ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(o.code)&&(m[o.code]=!0,o.preventDefault())});window.addEventListener("keyup",o=>{["ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(o.code)&&(m[o.code]=!1,o.preventDefault())});function C(){let o=0,i=0;return m.ArrowUp&&(o+=1),m.ArrowDown&&(o-=1),m.ArrowLeft&&(i-=1),m.ArrowRight&&(i+=1),{forward:o,turn:i}}function A(){e.clearRect(0,0,c.width,c.height),e.save(),e.translate(-d.x,-d.y),e.save(),e.strokeStyle="#444",e.lineWidth=1;const o=50,i=Math.floor(d.x/o)*o,a=i+c.width+o,l=Math.floor(d.y/o)*o,r=l+c.height+o;for(let t=i;t<=a;t+=o)e.beginPath(),e.moveTo(t,d.y),e.lineTo(t,d.y+c.height),e.stroke();for(let t=l;t<=r;t+=o)e.beginPath(),e.moveTo(d.x,t),e.lineTo(d.x+c.width,t),e.stroke();e.restore();const{forward:s,turn:f}=C();(s!==0||f!==0)&&g?w.send({type:"move",forward:s,turn:f,cannonAngle:v}):s===0&&f===0&&(b.forward!==0||b.turn!==0)&&g&&w.send({type:"move",forward:0,turn:0,cannonAngle:v}),b={forward:s,turn:f};for(const t of S)e.save(),e.fillStyle="#666",e.strokeStyle="#333",e.lineWidth=2,t.type==="rect"?(e.fillRect(t.x,t.y,t.width,t.height),e.strokeRect(t.x,t.y,t.width,t.height)):(e.beginPath(),e.arc(t.x+t.width/2,t.y+t.height/2,t.width/2,0,2*Math.PI),e.fill(),e.stroke()),e.restore();for(const t of y.mines){e.save();const n=Math.floor(Date.now()/200)%2;e.fillStyle=t.exploded||n?"#ff0000":"#ffff00",e.strokeStyle="#cc0000",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,8,0,2*Math.PI),e.fill(),e.stroke(),t.exploded||(e.fillStyle="#fff",e.font="10px Arial",e.textAlign="center",e.fillText("!",t.x,t.y+3)),e.restore()}for(const t of y.bullets)e.save(),e.fillStyle="#ffff00",e.strokeStyle="#ffaa00",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,4,0,2*Math.PI),e.fill(),e.stroke(),e.restore();for(const t in y.players){const n=y.players[t];if(n.lives<=0||Date.now()<n.deadUntil)continue;e.save(),e.translate(n.x,n.y),e.rotate(n.angle),L(e,n);const h=t===g;e.fillStyle="#4a4a4a",e.fillRect(-n.bodyWidth/2,-n.bodyHeight/2,n.bodyWidth,n.bodyHeight),e.strokeStyle="#2a2a2a",e.lineWidth=2,e.strokeRect(-n.bodyWidth/2,-n.bodyHeight/2,n.bodyWidth,n.bodyHeight),e.fillStyle=h?"#5a5a5a":"#4a4a5a",e.beginPath(),e.arc(0,0,n.turretRadius,0,Math.PI*2),e.fill(),e.stroke(),e.save(),e.rotate(n.cannonAngle-n.angle),e.fillStyle="#3a3a3a",e.fillRect(0,-n.cannonWidth/2,n.cannonLength,n.cannonWidth),e.strokeRect(0,-n.cannonWidth/2,n.cannonLength,n.cannonWidth),e.fillStyle="#2a2a2a",e.beginPath(),e.arc(n.cannonLength,0,n.cannonWidth/2,0,Math.PI*2),e.fill(),e.restore(),e.fillStyle=h?"#6a6a6a":"#5a5a6a",e.beginPath(),e.arc(0,0,8,0,Math.PI*2),e.fill(),e.restore(),e.save(),e.translate(n.x,n.y),e.fillStyle="rgba(0,0,0,0.7)",e.fillRect(-35,-50,70,15),e.fillStyle=h?"#4CAF50":"#2196F3",e.font="bold 12px Arial",e.textAlign="center",e.fillText(h?"YOU":`P${t.slice(0,3)}`,0,-40);const p=50,W=n.lives/((u==null?void 0:u.maxLives)||3)*p;e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(-25,35,p,4),e.fillStyle=n.lives>1?"#4CAF50":"#F44336",e.fillRect(-25,35,W,4),e.restore()}function L(t,n){t.fillStyle="#2a2a2a",t.fillRect(-n.trackLength/2,-n.bodyHeight/2-n.trackWidth,n.trackLength,n.trackWidth),t.fillRect(-n.trackLength/2,n.bodyHeight/2,n.trackLength,n.trackWidth),t.fillStyle="#1a1a1a";for(let h=-n.trackLength/2+10;h<n.trackLength/2;h+=15)t.beginPath(),t.arc(h,-n.bodyHeight/2-n.trackWidth/2,4,0,Math.PI*2),t.fill(),t.beginPath(),t.arc(h,n.bodyHeight/2+n.trackWidth/2,4,0,Math.PI*2),t.fill()}const M=Date.now();x=x.filter(t=>{const n=M-t.time;if(n>200)return!1;e.save();const h=1-n/200;e.globalAlpha=h,e.fillStyle="#ffaa00";const p=5+n/200*10;return e.beginPath(),e.arc(t.x,t.y,p,0,2*Math.PI),e.fill(),e.restore(),!0}),e.restore(),requestAnimationFrame(A)}A();
