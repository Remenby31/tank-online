(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))l(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&l(f)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function l(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();class W{constructor(){this.onInit=()=>{},this.onState=()=>{},this.messageQueue=[],this.isConnected=!1;const i=location.port||"8080";this.ws=new WebSocket(`ws://${location.hostname}:${i}`),this.ws.onopen=()=>{for(console.log("Connected to game server"),this.isConnected=!0;this.messageQueue.length>0;){const r=this.messageQueue.shift();this.ws.send(JSON.stringify(r))}},this.ws.onmessage=r=>{const l=JSON.parse(r.data);l.type==="init"&&this.onInit(l),l.type==="state"&&this.onState(l)},this.ws.onerror=r=>{console.error("WebSocket error:",r)},this.ws.onclose=()=>{console.log("Disconnected from game server"),this.isConnected=!1}}send(i){this.isConnected&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(i)):(this.messageQueue.push(i),console.log("Message queued, WebSocket not ready yet"))}}function I(o,i,r,l){const n=document.getElementById("ui");if(!n)return;const s=i>0?`Cooldown ${(i/1e3).toFixed(1)}s`:"Ready",f=i>0?"#ff6b6b":"#51cf66";n.innerHTML=`
    <div style="background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 2px solid #4CAF50;">
      <div style="font-size: 20px; font-weight: bold; color: #ff6b6b;">‚ù§Ô∏è Lives: ${o}</div>
      <div style="font-size: 16px; color: ${f};">‚è±Ô∏è Status: ${s}</div>
      ${r?`<div style="font-size: 14px; color: #74c0fc;">üë• Players: ${r}</div>`:""}
      ${l!==void 0?`<div style="font-size: 14px; color: #ffd43b;">üí£ Mines: ${l}</div>`:""}
    </div>
    <div style="background: rgba(0,0,0,0.7); padding: 12px; border-radius: 8px; font-size: 13px; line-height: 1.4;">
      <div style="font-weight: bold; margin-bottom: 5px;">üéÆ <strong>Tank Controls:</strong></div>
      <div>‚Ä¢ <strong>W/‚Üë:</strong> Move forward</div>
      <div>‚Ä¢ <strong>S/‚Üì:</strong> Move backward</div>
      <div>‚Ä¢ <strong>A/‚Üê:</strong> Turn left</div>
      <div>‚Ä¢ <strong>D/‚Üí:</strong> Turn right</div>
      <div>‚Ä¢ <strong>Mouse:</strong> Aim cannon</div>
      <div>‚Ä¢ <strong>Left Click:</strong> Shoot</div>
      <div>‚Ä¢ <strong>Spacebar:</strong> Place mine</div>
    </div>
  `}const c=document.getElementById("game"),e=c.getContext("2d");let g="",p,R=[],a={x:0,y:0};function P(){c.width=window.innerWidth,c.height=window.innerHeight}P();window.addEventListener("resize",P);let h={players:{},bullets:[],mines:[],map:[]},k=[];const v=new W;v.onInit=o=>{g=o.playerId,p=o.config,R=o.map,console.log("Player initialized:",g)};v.onState=o=>{h=o.state;const i=h.players[g];if(i){const r=Object.keys(h.players).length,l=i.mines.length;I(i.lives,i.cooldown,r,l),a.x=i.x-c.width/2,a.y=i.y-c.height/2,p&&(a.x=Math.max(0,Math.min(p.mapWidth-c.width,a.x)),a.y=Math.max(0,Math.min(p.mapHeight-c.height,a.y)))}};let m=0;c.addEventListener("mousemove",o=>{const i=c.getBoundingClientRect(),r=h.players[g];if(!r)return;const l=o.clientX-i.left+a.x,n=o.clientY-i.top+a.y,s=l-r.x,f=n-r.y;m=Math.atan2(f,s)});c.addEventListener("mousedown",()=>{if(!g){console.log("Player not initialized yet");return}v.send({type:"shoot",angle:m});const o=h.players[g];o&&k.push({x:o.x+Math.cos(m)*40,y:o.y+Math.sin(m)*40,time:Date.now()})});window.addEventListener("keydown",o=>{if(o.code==="Space"){if(!g){console.log("Player not initialized yet");return}v.send({type:"mine"})}});const y={};let b={forward:0,turn:0};window.addEventListener("keydown",o=>{["KeyZ","KeyQ","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(o.code)&&(y[o.code]=!0,o.preventDefault())});window.addEventListener("keyup",o=>{["KeyZ","KeyQ","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(o.code)&&(y[o.code]=!1,o.preventDefault())});function E(){let o=0,i=0;return(y.KeyZ||y.ArrowUp)&&(o+=1),(y.KeyS||y.ArrowDown)&&(o-=1),(y.KeyQ||y.ArrowLeft)&&(i-=1),(y.KeyD||y.ArrowRight)&&(i+=1),{forward:o,turn:i}}function L(){e.clearRect(0,0,c.width,c.height),e.save(),e.translate(-a.x,-a.y),e.save(),e.strokeStyle="#444",e.lineWidth=1;const o=50,i=Math.floor(a.x/o)*o,r=i+c.width+o,l=Math.floor(a.y/o)*o,n=l+c.height+o;for(let t=i;t<=r;t+=o)e.beginPath(),e.moveTo(t,a.y),e.lineTo(t,a.y+c.height),e.stroke();for(let t=l;t<=n;t+=o)e.beginPath(),e.moveTo(a.x,t),e.lineTo(a.x+c.width,t),e.stroke();e.restore();const{forward:s,turn:f}=E();(s!==b.forward||f!==b.turn)&&g&&(v.send({type:"move",forward:s,turn:f}),b={forward:s,turn:f});for(const t of R)e.save(),e.fillStyle="#666",e.strokeStyle="#333",e.lineWidth=2,t.type==="rect"?(e.fillRect(t.x,t.y,t.width,t.height),e.strokeRect(t.x,t.y,t.width,t.height)):(e.beginPath(),e.arc(t.x+t.width/2,t.y+t.height/2,t.width/2,0,2*Math.PI),e.fill(),e.stroke()),e.restore();for(const t of h.mines){e.save();const d=Math.floor(Date.now()/200)%2;e.fillStyle=t.exploded||d?"#ff0000":"#ffff00",e.strokeStyle="#cc0000",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,8,0,2*Math.PI),e.fill(),e.stroke(),t.exploded||(e.fillStyle="#fff",e.font="10px Arial",e.textAlign="center",e.fillText("!",t.x,t.y+3)),e.restore()}for(const t of h.bullets)e.save(),e.fillStyle="#ffff00",e.strokeStyle="#ffaa00",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,4,0,2*Math.PI),e.fill(),e.stroke(),e.restore();for(const t in h.players){const d=h.players[t];if(d.lives<=0||Date.now()<d.deadUntil)continue;e.save(),e.translate(d.x,d.y),e.save(),e.translate(3,3),e.fillStyle="rgba(0,0,0,0.3)",e.fillRect(-25,-18,50,36),e.restore(),e.fillStyle="#333",e.fillRect(-25,-18,8,36),e.fillRect(17,-18,8,36),e.fillStyle="#222";const x=Date.now()*.01*(Math.abs(d.velocity.x)+Math.abs(d.velocity.y))%12;for(let w=-15;w<=15;w+=6){const M=(w+x)%12-6;e.fillRect(-23,w+M,4,3),e.fillRect(19,w+M,4,3)}const u=t===g;e.fillStyle=u?"#4CAF50":"#2196F3",e.fillRect(-20,-15,40,30);const S=e.createLinearGradient(-20,-15,-20,15);S.addColorStop(0,u?"#66BB6A":"#42A5F5"),S.addColorStop(1,u?"#2E7D32":"#1565C0"),e.fillStyle=S,e.fillRect(-20,-15,40,30),e.strokeStyle="#000",e.lineWidth=2,e.strokeRect(-20,-15,40,30),e.fillStyle="#666",e.fillRect(-15,-10,30,3),e.fillRect(-10,5,20,3),e.fillStyle=u?"#388E3C":"#1976D2",e.beginPath(),e.arc(0,0,12,0,2*Math.PI),e.fill(),e.stroke(),e.save(),e.rotate(d.angle),e.fillStyle="rgba(0,0,0,0.2)",e.fillRect(1,-4,36,8),e.fillStyle="#555",e.fillRect(0,-4,35,8),e.fillStyle="#333",e.fillRect(30,-2,8,4),e.strokeStyle="#000",e.lineWidth=1.5,e.strokeRect(0,-4,35,8),e.restore(),e.fillStyle="rgba(0,0,0,0.7)",e.fillRect(-25,-35,50,15),e.fillStyle="#fff",e.font="bold 12px Arial",e.textAlign="center",e.fillText(u?"YOU":`P${t.slice(0,3)}`,0,-25);const A=40,D=d.lives/((p==null?void 0:p.maxLives)||3)*A;e.fillStyle="rgba(0,0,0,0.5)",e.fillRect(-20,20,A,4),e.fillStyle=d.lives>1?"#4CAF50":"#F44336",e.fillRect(-20,20,D,4),e.restore()}const C=Date.now();k=k.filter(t=>{const d=C-t.time;if(d>200)return!1;e.save();const x=1-d/200;e.globalAlpha=x,e.fillStyle="#ffaa00";const u=5+d/200*10;return e.beginPath(),e.arc(t.x,t.y,u,0,2*Math.PI),e.fill(),e.restore(),!0}),e.restore(),requestAnimationFrame(L)}L();
