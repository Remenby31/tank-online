(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const s of t)if(s.type==="childList")for(const f of s.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function n(t){const s={};return t.integrity&&(s.integrity=t.integrity),t.referrerPolicy&&(s.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?s.credentials="include":t.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(t){if(t.ep)return;t.ep=!0;const s=n(t);fetch(t.href,s)}})();class x{constructor(){this.onInit=()=>{},this.onState=()=>{},this.messageQueue=[],this.isConnected=!1;const i=location.port||"8080";this.ws=new WebSocket(`ws://${location.hostname}:${i}`),this.ws.onopen=()=>{for(console.log("Connected to game server"),this.isConnected=!0;this.messageQueue.length>0;){const n=this.messageQueue.shift();this.ws.send(JSON.stringify(n))}},this.ws.onmessage=n=>{const r=JSON.parse(n.data);r.type==="init"&&this.onInit(r),r.type==="state"&&this.onState(r)},this.ws.onerror=n=>{console.error("WebSocket error:",n)},this.ws.onclose=()=>{console.log("Disconnected from game server"),this.isConnected=!1}}send(i){this.isConnected&&this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(i)):(this.messageQueue.push(i),console.log("Message queued, WebSocket not ready yet"))}}function b(o,i,n,r){const t=document.getElementById("ui");if(!t)return;const s=i>0?`Cooldown ${(i/1e3).toFixed(1)}s`:"Ready",f=i>0?"#ff6b6b":"#51cf66";t.innerHTML=`
    <div style="background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 2px solid #4CAF50;">
      <div style="font-size: 20px; font-weight: bold; color: #ff6b6b;">‚ù§Ô∏è Lives: ${o}</div>
      <div style="font-size: 16px; color: ${f};">‚è±Ô∏è Status: ${s}</div>
      ${n?`<div style="font-size: 14px; color: #74c0fc;">üë• Players: ${n}</div>`:""}
      ${r!==void 0?`<div style="font-size: 14px; color: #ffd43b;">üí£ Mines: ${r}</div>`:""}
    </div>
    <div style="background: rgba(0,0,0,0.7); padding: 12px; border-radius: 8px; font-size: 13px; line-height: 1.4;">
      <div style="font-weight: bold; margin-bottom: 5px;">üéÆ <strong>Controls:</strong></div>
      <div>‚Ä¢ <strong>WASD/Arrow Keys:</strong> Move tank</div>
      <div>‚Ä¢ <strong>Mouse:</strong> Aim cannon</div>
      <div>‚Ä¢ <strong>Left Click:</strong> Shoot</div>
      <div>‚Ä¢ <strong>Spacebar:</strong> Place mine</div>
    </div>
  `}const l=document.getElementById("game"),e=l.getContext("2d");let c="",y,m=[],d={players:{},bullets:[],mines:[],map:[]},p=[];const h=new x;h.onInit=o=>{c=o.playerId,y=o.config,m=o.map};h.onState=o=>{d=o.state;const i=d.players[c];if(i){const n=Object.keys(d.players).length,r=i.mines.length;b(i.lives,i.cooldown,n,r),y&&(l.width!==y.mapWidth||l.height!==y.mapHeight)&&(l.width=y.mapWidth,l.height=y.mapHeight)}};let g=0;l.addEventListener("mousemove",o=>{const i=l.getBoundingClientRect(),n=d.players[c];if(!n)return;const r=o.clientX-i.left-n.x,t=o.clientY-i.top-n.y;g=Math.atan2(t,r)});l.addEventListener("mousedown",()=>{if(!c){console.log("Player not initialized yet");return}h.send({type:"shoot",angle:g});const o=d.players[c];o&&p.push({x:o.x+Math.cos(g)*40,y:o.y+Math.sin(g)*40,time:Date.now()})});window.addEventListener("keydown",o=>{if(o.code==="Space"){if(!c){console.log("Player not initialized yet");return}h.send({type:"mine"})}});const a={};let u={dx:0,dy:0};window.addEventListener("keydown",o=>{["KeyZ","KeyQ","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(o.code)&&(a[o.code]=!0,o.preventDefault())});window.addEventListener("keyup",o=>{["KeyZ","KeyQ","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(o.code)&&(a[o.code]=!1,o.preventDefault())});function S(){let o=0,i=0;return(a.KeyZ||a.ArrowUp)&&(i-=1),(a.KeyS||a.ArrowDown)&&(i+=1),(a.KeyQ||a.ArrowLeft)&&(o-=1),(a.KeyD||a.ArrowRight)&&(o+=1),{dx:o,dy:i}}function w(){e.clearRect(0,0,l.width,l.height),e.save(),e.strokeStyle="#444",e.lineWidth=1;const o=50;for(let t=0;t<=l.width;t+=o)e.beginPath(),e.moveTo(t,0),e.lineTo(t,l.height),e.stroke();for(let t=0;t<=l.height;t+=o)e.beginPath(),e.moveTo(0,t),e.lineTo(l.width,t),e.stroke();e.restore();const{dx:i,dy:n}=S();(i!==u.dx||n!==u.dy)&&c&&(h.send({type:"move",dx:i,dy:n}),u={dx:i,dy:n});for(const t of m)e.save(),e.fillStyle="#666",e.strokeStyle="#333",e.lineWidth=2,t.type==="rect"?(e.fillRect(t.x,t.y,t.width,t.height),e.strokeRect(t.x,t.y,t.width,t.height)):(e.beginPath(),e.arc(t.x+t.width/2,t.y+t.height/2,t.width/2,0,2*Math.PI),e.fill(),e.stroke()),e.restore();for(const t of d.mines){e.save();const s=Math.floor(Date.now()/200)%2;e.fillStyle=t.exploded||s?"#ff0000":"#ffff00",e.strokeStyle="#cc0000",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,8,0,2*Math.PI),e.fill(),e.stroke(),t.exploded||(e.fillStyle="#fff",e.font="10px Arial",e.textAlign="center",e.fillText("!",t.x,t.y+3)),e.restore()}for(const t of d.bullets)e.save(),e.fillStyle="#ffff00",e.strokeStyle="#ffaa00",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,4,0,2*Math.PI),e.fill(),e.stroke(),e.restore();for(const t in d.players){const s=d.players[t];s.lives<=0||Date.now()<s.deadUntil||(e.save(),e.translate(s.x,s.y),e.fillStyle=t===c?"#00ff00":"#00ffff",e.fillRect(-20,-15,40,30),e.strokeStyle="#000",e.lineWidth=2,e.strokeRect(-20,-15,40,30),e.save(),e.rotate(s.angle),e.fillStyle="#444",e.fillRect(0,-5,35,10),e.strokeStyle="#000",e.strokeRect(0,-5,35,10),e.restore(),e.fillStyle="#fff",e.font="12px Arial",e.textAlign="center",e.fillText(t===c?"YOU":`P${t.slice(0,3)}`,0,-25),e.restore())}const r=Date.now();p=p.filter(t=>{const s=r-t.time;if(s>200)return!1;e.save();const f=1-s/200;e.globalAlpha=f,e.fillStyle="#ffaa00";const v=5+s/200*10;return e.beginPath(),e.arc(t.x,t.y,v,0,2*Math.PI),e.fill(),e.restore(),!0}),requestAnimationFrame(w)}w();
