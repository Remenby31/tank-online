(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))s(t);new MutationObserver(t=>{for(const n of t)if(n.type==="childList")for(const c of n.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&s(c)}).observe(document,{childList:!0,subtree:!0});function r(t){const n={};return t.integrity&&(n.integrity=t.integrity),t.referrerPolicy&&(n.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?n.credentials="include":t.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(t){if(t.ep)return;t.ep=!0;const n=r(t);fetch(t.href,n)}})();class x{constructor(){this.onInit=()=>{},this.onState=()=>{};const i=location.port||"8080";this.ws=new WebSocket(`ws://${location.hostname}:${i}`),this.ws.onopen=()=>{console.log("Connected to game server")},this.ws.onmessage=r=>{const s=JSON.parse(r.data);s.type==="init"&&this.onInit(s),s.type==="state"&&this.onState(s)},this.ws.onerror=r=>{console.error("WebSocket error:",r)},this.ws.onclose=()=>{console.log("Disconnected from game server")}}send(i){this.ws.send(JSON.stringify(i))}}function b(o,i,r,s){const t=document.getElementById("ui");if(!t)return;const n=i>0?`Cooldown ${(i/1e3).toFixed(1)}s`:"Ready",c=i>0?"#ff6b6b":"#51cf66";t.innerHTML=`
    <div style="background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; margin-bottom: 10px; border: 2px solid #4CAF50;">
      <div style="font-size: 20px; font-weight: bold; color: #ff6b6b;">‚ù§Ô∏è Lives: ${o}</div>
      <div style="font-size: 16px; color: ${c};">‚è±Ô∏è Status: ${n}</div>
      ${r?`<div style="font-size: 14px; color: #74c0fc;">üë• Players: ${r}</div>`:""}
      ${s!==void 0?`<div style="font-size: 14px; color: #ffd43b;">üí£ Mines: ${s}</div>`:""}
    </div>
    <div style="background: rgba(0,0,0,0.7); padding: 12px; border-radius: 8px; font-size: 13px; line-height: 1.4;">
      <div style="font-weight: bold; margin-bottom: 5px;">üéÆ <strong>Controls:</strong></div>
      <div>‚Ä¢ <strong>WASD/Arrow Keys:</strong> Move tank</div>
      <div>‚Ä¢ <strong>Mouse:</strong> Aim cannon</div>
      <div>‚Ä¢ <strong>Left Click:</strong> Shoot</div>
      <div>‚Ä¢ <strong>Spacebar:</strong> Place mine</div>
    </div>
  `}const l=document.getElementById("game"),e=l.getContext("2d");let y="",f,m=[],d={players:{},bullets:[],mines:[],map:[]},u=[];const h=new x;h.onInit=o=>{y=o.playerId,f=o.config,m=o.map};h.onState=o=>{d=o.state;const i=d.players[y];if(i){const r=Object.keys(d.players).length,s=i.mines.length;b(i.lives,i.cooldown,r,s),f&&(l.width!==f.mapWidth||l.height!==f.mapHeight)&&(l.width=f.mapWidth,l.height=f.mapHeight)}};let p=0;l.addEventListener("mousemove",o=>{const i=l.getBoundingClientRect(),r=d.players[y];if(!r)return;const s=o.clientX-i.left-r.x,t=o.clientY-i.top-r.y;p=Math.atan2(t,s)});l.addEventListener("mousedown",()=>{h.send({type:"shoot",angle:p});const o=d.players[y];o&&u.push({x:o.x+Math.cos(p)*40,y:o.y+Math.sin(p)*40,time:Date.now()})});window.addEventListener("keydown",o=>{o.code==="Space"&&h.send({type:"mine"})});const a={};let g={dx:0,dy:0};window.addEventListener("keydown",o=>{["KeyZ","KeyQ","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(o.code)&&(a[o.code]=!0,o.preventDefault())});window.addEventListener("keyup",o=>{["KeyZ","KeyQ","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowDown","ArrowRight"].includes(o.code)&&(a[o.code]=!1,o.preventDefault())});function S(){let o=0,i=0;return(a.KeyZ||a.ArrowUp)&&(i-=1),(a.KeyS||a.ArrowDown)&&(i+=1),(a.KeyQ||a.ArrowLeft)&&(o-=1),(a.KeyD||a.ArrowRight)&&(o+=1),{dx:o,dy:i}}function w(){e.clearRect(0,0,l.width,l.height),e.save(),e.strokeStyle="#444",e.lineWidth=1;const o=50;for(let t=0;t<=l.width;t+=o)e.beginPath(),e.moveTo(t,0),e.lineTo(t,l.height),e.stroke();for(let t=0;t<=l.height;t+=o)e.beginPath(),e.moveTo(0,t),e.lineTo(l.width,t),e.stroke();e.restore();const{dx:i,dy:r}=S();(i!==g.dx||r!==g.dy)&&(h.send({type:"move",dx:i,dy:r}),g={dx:i,dy:r});for(const t of m)e.save(),e.fillStyle="#666",e.strokeStyle="#333",e.lineWidth=2,t.type==="rect"?(e.fillRect(t.x,t.y,t.width,t.height),e.strokeRect(t.x,t.y,t.width,t.height)):(e.beginPath(),e.arc(t.x+t.width/2,t.y+t.height/2,t.width/2,0,2*Math.PI),e.fill(),e.stroke()),e.restore();for(const t of d.mines){e.save();const n=Math.floor(Date.now()/200)%2;e.fillStyle=t.exploded||n?"#ff0000":"#ffff00",e.strokeStyle="#cc0000",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,8,0,2*Math.PI),e.fill(),e.stroke(),t.exploded||(e.fillStyle="#fff",e.font="10px Arial",e.textAlign="center",e.fillText("!",t.x,t.y+3)),e.restore()}for(const t of d.bullets)e.save(),e.fillStyle="#ffff00",e.strokeStyle="#ffaa00",e.lineWidth=2,e.beginPath(),e.arc(t.x,t.y,4,0,2*Math.PI),e.fill(),e.stroke(),e.restore();for(const t in d.players){const n=d.players[t];n.lives<=0||Date.now()<n.deadUntil||(e.save(),e.translate(n.x,n.y),e.fillStyle=t===y?"#00ff00":"#00ffff",e.fillRect(-20,-15,40,30),e.strokeStyle="#000",e.lineWidth=2,e.strokeRect(-20,-15,40,30),e.save(),e.rotate(n.angle),e.fillStyle="#444",e.fillRect(0,-5,35,10),e.strokeStyle="#000",e.strokeRect(0,-5,35,10),e.restore(),e.fillStyle="#fff",e.font="12px Arial",e.textAlign="center",e.fillText(t===y?"YOU":`P${t.slice(0,3)}`,0,-25),e.restore())}const s=Date.now();u=u.filter(t=>{const n=s-t.time;if(n>200)return!1;e.save();const c=1-n/200;e.globalAlpha=c,e.fillStyle="#ffaa00";const v=5+n/200*10;return e.beginPath(),e.arc(t.x,t.y,v,0,2*Math.PI),e.fill(),e.restore(),!0}),requestAnimationFrame(w)}w();
